#!/usr/bin/env perl

use File::Basename;
use strict;

my $utildirname = dirname($0);

my $preset = $ENV{'CHPL_WIDE_POINTERS'};
my $set = "";

if ($preset eq "") {
  $set = "struct";
} else {
  $set = $preset;
}

my $define = "";
if ($set eq "struct") {
  $define = "-DCHPL_WIDE_POINTER_STRUCT";
} elsif ($set =~ /node(\d+)/) {
  my $nodebits = $1;
  if( $nodebits < 2 || $nodebits > 60 ) {
    die "Bad node bit width: $nodebits";
  }
  $define = "-DCHPL_WIDE_POINTER_PACKED -DCHPL_WIDE_POINTER_NODE_BITS=$nodebits";
} else {
  die "Unknown wide pointer format: $set";
}

if( @ARGV > 0 && ($ARGV[0] eq "--define" || $ARGV[0] eq "--defines") ) {
  print "$define\n";
} else {
  print "$set\n";
}
exit(0);
